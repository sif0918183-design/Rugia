<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</title>
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ÙˆÙÙ‚ Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ø³Ù†Ø©">
    <meta name="theme-color" content="#0a5c36">
    
    <!-- Ø±Ø§Ø¨Ø· PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª PWA -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>">
    
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #0a5c36;
            --secondary-color: #128c7e;
            --light-green: #d4edda;
            --gold-color: #d4af37;
            --dark-color: #1a1a2e;
            --text-color: #333;
            --light-color: #f8f9fa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Noto Naskh Arabic', 'Amiri', serif;
            background: linear-gradient(135deg, #f0f7f4 0%, #e3f2e9 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            z-index: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´ØºÙ„ */
        .player-panel {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }
        
        .current-track-info {
            text-align: center;
            margin-bottom: 25px;
        }
        
        #current-track-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        #current-track-description {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            margin: 25px 0;
        }
        
        .progress-time {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            width: 0%;
            border-radius: 4px;
            transition: width 0.1s linear;
        }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 30px 0;
        }
        
        .control-btn, .play-btn {
            background-color: #f0f7f4;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--primary-color);
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(10, 92, 54, 0.15);
        }
        
        .play-btn {
            width: 80px;
            height: 80px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            font-size: 1.8rem;
        }
        
        .control-btn:hover, .play-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(10, 92, 54, 0.2);
        }
        
        .control-btn:active, .play-btn:active {
            transform: translateY(0);
        }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© */
        .extra-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .extra-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #f0f7f4;
            border: 1px solid #d1e7dd;
            border-radius: 30px;
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .extra-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .extra-btn:hover {
            background-color: #e2f0eb;
        }
        
        .extra-btn.active:hover {
            background-color: #0a5230;
        }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ */
        .tracks-section {
            margin-top: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tracks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .track-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 18px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .track-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .track-item.active {
            border-left-color: var(--primary-color);
            background-color: #f0f9f5;
        }
        
        .track-number {
            background-color: #e9f5ef;
            color: var(--primary-color);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .track-info {
            flex: 1;
        }
        
        .track-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .track-duration {
            font-size: 0.85rem;
            color: #666;
        }
        
        .playing-indicator {
            color: var(--primary-color);
            font-size: 1.2rem;
            opacity: 0;
        }
        
        .track-item.active .playing-indicator {
            opacity: 1;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        /* ÙÙˆØªØ± */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateY(150%);
            transition: transform 0.5s ease;
        }
        
        .install-prompt.show {
            transform: translateY(0);
        }
        
        .install-text {
            flex: 1;
        }
        
        .install-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .install-description {
            font-size: 0.9rem;
            color: #666;
        }
        
        .install-btn {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            margin-left: 15px;
        }
        
        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(10, 92, 54, 0.2);
        }
        
        .close-install {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        /* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .player-panel {
                padding: 20px 15px;
            }
            
            #current-track-title {
                font-size: 1.2rem;
            }
            
            .player-controls {
                gap: 20px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
            }
            
            .play-btn {
                width: 70px;
                height: 70px;
                font-size: 1.5rem;
            }
            
            .extra-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .install-prompt {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .install-btn {
                margin-left: 0;
            }
            
            .close-install {
                position: absolute;
                top: 10px;
                left: 15px;
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª ØªØ­Ù…ÙŠÙ„ */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØªÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© */
        .audio-error {
            color: #dc3545;
            text-align: center;
            padding: 20px;
            background-color: #f8d7da;
            border-radius: var(--border-radius);
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="fas fa-mosque"></i>
                    Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©
                </h1>
                <p class="app-subtitle">Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</p>
            </div>
        </header>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø´ØºÙ„ -->
        <div class="player-panel">
            <div class="current-track-info">
                <h2 id="current-track-title">Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>
                <p id="current-track-description">Ù…Ù† ÙƒØªØ§Ø¨ Ø­ØµÙ† Ø§Ù„Ù…Ø³Ù„Ù…</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-time">
                    <span id="current-time">00:00</span>
                    <span id="total-time">00:00</span>
                </div>
                <div class="progress-bar">
                    <div id="progress" class="progress"></div>
                </div>
            </div>
            
            <div class="player-controls">
                <button id="prev-btn" class="control-btn" aria-label="Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚">
                    <i class="fas fa-step-backward"></i>
                </button>
                
                <button id="play-pause-btn" class="play-btn" aria-label="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù">
                    <i class="fas fa-play" id="play-icon"></i>
                </button>
                
                <button id="next-btn" class="control-btn" aria-label="Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="extra-controls">
                <button id="repeat-btn" class="extra-btn active" aria-label="ØªÙƒØ±Ø§Ø± Ø§Ù„ØªØ´ØºÙŠÙ„">
                    <i class="fas fa-redo"></i>
                    <span>ØªÙƒØ±Ø§Ø±</span>
                </button>
                
                <button id="auto-next-btn" class="extra-btn active" aria-label="ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ">
                    <i class="fas fa-play-circle"></i>
                    <span>ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                </button>
            </div>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ -->
        <div class="tracks-section">
            <h3 class="section-title">
                <i class="fas fa-list"></i>
                Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹
            </h3>
            
            <div class="tracks-list" id="tracks-list">
                <!-- Ø³ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
        
        <!-- Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ© -->
        <div class="audio-error" id="audio-error">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.</p>
        </div>
        
        <!-- ÙÙˆØªØ± -->
        <div class="footer">
            <p>Â© 2023 ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p>ØªÙØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠØ© Ù„Ø£ØºØ±Ø§Ø¶ ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ¹Ù„Ø§Ø¬ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</p>
        </div>
    </div>
    
    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="install-prompt" id="install-prompt">
        <button class="close-install" id="close-install" aria-label="Ø¥ØºÙ„Ø§Ù‚">
            <i class="fas fa-times"></i>
        </button>
        <div class="install-text">
            <div class="install-title">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
            <div class="install-description">Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</div>
        </div>
        <button class="install-btn" id="install-btn">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
    </div>
    
    <!-- Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ÙÙŠ -->
    <audio id="audio-player" preload="metadata"></audio>
    
    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©)
        const tracks = [
            {
                id: 1,
                title: "Ø§Ù„ÙØ§ØªØ­Ø© ÙˆØ£ÙˆØ§Ø¦Ù„ Ø§Ù„Ø¨Ù‚Ø±Ø©",
                description: "Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© ÙˆØ§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©",
                filename: "track1.mp3",
                duration: "05:30"
            },
            {
                id: 2,
                title: "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ",
                description: "Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø© Ø¢ÙŠØ© 255",
                filename: "track2.mp3",
                duration: "03:15"
            },
            {
                id: 3,
                title: "Ø£ÙˆØ§Ø®Ø± Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©",
                description: "Ø§Ù„Ø¢ÙŠØªØ§Ù† Ø§Ù„Ø£Ø®ÙŠØ±ØªØ§Ù† Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©",
                filename: "track3.mp3",
                duration: "02:45"
            },
            {
                id: 4,
                title: "Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙˆØ§Ù„Ù…Ø¹ÙˆØ°ØªÙŠÙ†",
                description: "Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙˆØ§Ù„ÙÙ„Ù‚ ÙˆØ§Ù„Ù†Ø§Ø³",
                filename: "track4.mp3",
                duration: "04:20"
            },
            {
                id: 5,
                title: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡",
                description: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†Ø¨ÙˆÙŠØ©",
                filename: "track5.mp3",
                duration: "06:10"
            },
            {
                id: 6,
                title: "Ø§Ù„Ø±Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ù†Ø©",
                description: "Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ù†Ø¨ÙˆÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©",
                filename: "track6.mp3",
                duration: "07:05"
            }
        ];

        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const state = {
            currentTrackIndex: 0,
            isPlaying: false,
            isRepeat: true,
            isAutoNext: true,
            audioFilesBasePath: "audio-files/",
            deferredPrompt: null
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const audioPlayer = document.getElementById('audio-player');
        const currentTrackTitle = document.getElementById('current-track-title');
        const currentTrackDescription = document.getElementById('current-track-description');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('current-time');
        const totalTimeEl = document.getElementById('total-time');
        const repeatBtn = document.getElementById('repeat-btn');
        const autoNextBtn = document.getElementById('auto-next-btn');
        const tracksList = document.getElementById('tracks-list');
        const audioError = document.getElementById('audio-error');
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const closeInstall = document.getElementById('close-install');

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            renderTracksList();
            loadTrack(state.currentTrackIndex);
            setupEventListeners();
            setupAudioPlayer();
            checkAudioFiles();
            registerServiceWorker();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
            setTimeout(() => {
                if (state.deferredPrompt === null) {
                    installPrompt.classList.add('show');
                }
            }, 5000);
        }

        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹
        function renderTracksList() {
            tracksList.innerHTML = '';
            
            tracks.forEach((track, index) => {
                const trackItem = document.createElement('div');
                trackItem.className = `track-item ${index === state.currentTrackIndex ? 'active' : ''}`;
                trackItem.setAttribute('data-index', index);
                
                trackItem.innerHTML = `
                    <div class="track-number">${track.id}</div>
                    <div class="track-info">
                        <div class="track-title">${track.title}</div>
                        <div class="track-duration">${track.duration}</div>
                    </div>
                    <div class="playing-indicator">
                        <i class="fas fa-volume-up"></i>
                    </div>
                `;
                
                trackItem.addEventListener('click', () => {
                    if (state.currentTrackIndex !== index) {
                        state.currentTrackIndex = index;
                        loadTrack(index);
                        playTrack();
                    } else {
                        togglePlayPause();
                    }
                    
                    updateActiveTrack();
                });
                
                tracksList.appendChild(trackItem);
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
        function loadTrack(index) {
            if (index < 0 || index >= tracks.length) return;
            
            const track = tracks[index];
            const audioUrl = `${state.audioFilesBasePath}${track.filename}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            currentTrackTitle.textContent = track.title;
            currentTrackDescription.textContent = track.description;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠ
            audioPlayer.src = audioUrl;
            audioPlayer.load();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            if (state.isPlaying) {
                playTrack();
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø·
            updateActiveTrack();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹
        function playTrack() {
            const playPromise = audioPlayer.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    state.isPlaying = true;
                    playIcon.className = 'fas fa-pause';
                    playPauseBtn.setAttribute('aria-label', 'Ø¥ÙŠÙ‚Ø§Ù');
                }).catch(error => {
                    console.log("ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:", error);
                    state.isPlaying = false;
                    playIcon.className = 'fas fa-play';
                    playPauseBtn.setAttribute('aria-label', 'ØªØ´ØºÙŠÙ„');
                });
            }
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù‚Ø·Ø¹ Ù…Ø¤Ù‚ØªØ§Ù‹
        function pauseTrack() {
            audioPlayer.pause();
            state.isPlaying = false;
            playIcon.className = 'fas fa-play';
            playPauseBtn.setAttribute('aria-label', 'ØªØ´ØºÙŠÙ„');
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        function togglePlayPause() {
            if (state.isPlaying) {
                pauseTrack();
            } else {
                playTrack();
            }
        }

        // Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ
        function nextTrack() {
            state.currentTrackIndex++;
            
            if (state.currentTrackIndex >= tracks.length) {
                if (state.isRepeat) {
                    state.currentTrackIndex = 0;
                } else {
                    state.currentTrackIndex = tracks.length - 1;
                    pauseTrack();
                    return;
                }
            }
            
            loadTrack(state.currentTrackIndex);
            
            if (state.isPlaying) {
                playTrack();
            }
        }

        // Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
        function prevTrack() {
            state.currentTrackIndex--;
            
            if (state.currentTrackIndex < 0) {
                if (state.isRepeat) {
                    state.currentTrackIndex = tracks.length - 1;
                } else {
                    state.currentTrackIndex = 0;
                    pauseTrack();
                    return;
                }
            }
            
            loadTrack(state.currentTrackIndex);
            
            if (state.isPlaying) {
                playTrack();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function updateActiveTrack() {
            const trackItems = document.querySelectorAll('.track-item');
            trackItems.forEach((item, index) => {
                if (index === state.currentTrackIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress() {
            if (!audioPlayer.duration) return;
            
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progress.style.width = `${percent}%`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            totalTimeEl.textContent = formatTime(audioPlayer.duration);
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Ø¶Ø¨Ø· Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            
            audioPlayer.currentTime = (clickX / width) * duration;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØªÙŠØ©
        function checkAudioFiles() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ù‚Ø·Ø¹ Ù„Ù„ØªØ­Ù‚Ù‚
            const testAudio = new Audio();
            const testTrack = tracks[0];
            const testUrl = `${state.audioFilesBasePath}${testTrack.filename}`;
            
            testAudio.src = testUrl;
            testAudio.preload = 'metadata';
            
            testAudio.addEventListener('loadeddata', () => {
                audioError.style.display = 'none';
            });
            
            testAudio.addEventListener('error', () => {
                audioError.style.display = 'block';
            });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø´ØºÙ„
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', prevTrack);
            nextBtn.addEventListener('click', nextTrack);
            
            // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const progressBar = document.querySelector('.progress-bar');
            progressBar.addEventListener('click', setProgress);
            
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            repeatBtn.addEventListener('click', () => {
                state.isRepeat = !state.isRepeat;
                repeatBtn.classList.toggle('active', state.isRepeat);
            });
            
            autoNextBtn.addEventListener('click', () => {
                state.isAutoNext = !state.isAutoNext;
                autoNextBtn.classList.toggle('active', state.isAutoNext);
            });
            
            // ØªØ«Ø¨ÙŠØª PWA
            installBtn.addEventListener('click', async () => {
                if (state.deferredPrompt) {
                    state.deferredPrompt.prompt();
                    const { outcome } = await state.deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('ØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
                    }
                    
                    state.deferredPrompt = null;
                    installPrompt.classList.remove('show');
                }
            });
            
            closeInstall.addEventListener('click', () => {
                installPrompt.classList.remove('show');
            });
            
            // Ø­Ø¯Ø« Ù‚Ø¨Ù„ Ø§Ù„ØªØ«Ø¨ÙŠØª
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                state.deferredPrompt = e;
                installPrompt.classList.add('show');
            });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
        function setupAudioPlayer() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
            audioPlayer.addEventListener('timeupdate', updateProgress);
            
            // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø·Ø¹
            audioPlayer.addEventListener('ended', () => {
                if (state.isAutoNext) {
                    nextTrack();
                } else {
                    pauseTrack();
                }
            });
            
            // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø·Ø¹
            audioPlayer.addEventListener('loadedmetadata', () => {
                totalTimeEl.textContent = formatTime(audioPlayer.duration);
            });
            
            // Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
            audioPlayer.addEventListener('play', () => {
                state.isPlaying = true;
                playIcon.className = 'fas fa-pause';
            });
            
            // Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            audioPlayer.addEventListener('pause', () => {
                state.isPlaying = false;
                playIcon.className = 'fas fa-play';
            });
            
            // Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£
            audioPlayer.addEventListener('error', () => {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠ');
                audioError.style.display = 'block';
            });
        }

        // ØªØ³Ø¬ÙŠÙ„ Service Worker Ù„Ù€ PWA
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
                    });
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Ø¥Ø¶Ø§ÙØ© Service Worker Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
        const serviceWorkerCode = `
            // service-worker.js
            const CACHE_NAME = 'ruqya-app-v1';
            const urlsToCache = [
                './',
                './index.html',
                './manifest.json'
            ];

            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => {
                            return cache.addAll(urlsToCache);
                        })
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });

            self.addEventListener('activate', event => {
                event.waitUntil(
                    caches.keys().then(cacheNames => {
                        return Promise.all(
                            cacheNames.map(cacheName => {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });
        `;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù manifest.json Ø§ÙØªØ±Ø§Ø¶ÙŠ
        const manifest = {
            "name": "Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©",
            "short_name": "Ø§Ù„Ø±Ù‚ÙŠØ©",
            "description": "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ÙˆÙÙ‚ Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ø³Ù†Ø©",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#0a5c36",
            "theme_color": "#0a5c36",
            "icons": [
                {
                    "src": "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                },
                {
                    "src": "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>",
                    "sizes": "512x512",
                    "type": "image/svg+xml"
                }
            ]
        };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Service Worker Ùˆ Manifest Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        document.addEventListener('DOMContentLoaded', () => {
            // Ø¥Ù†Ø´Ø§Ø¡ Manifest Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                const manifestBlob = new Blob([JSON.stringify(manifest, null, 2)], {type: 'application/json'});
                const manifestURL = URL.createObjectURL(manifestBlob);
                manifestLink.href = manifestURL;
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
            if ('serviceWorker' in navigator) {
                try {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Service Worker Ù…Ù† Ù…Ù„Ù
                    navigator.serviceWorker.register('service-worker.js')
                        .catch(() => {
                            // Ø¥Ø°Ø§ ÙØ´Ù„ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Service Worker Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
                            const blob = new Blob([serviceWorkerCode], {type: 'application/javascript'});
                            const swURL = URL.createObjectURL(blob);
                            navigator.serviceWorker.register(swURL);
                        });
                } catch (error) {
                    console.log("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Service Worker:", error);
                }
            }
        });
    </script>
</body>
</html>
